const pickaxeRecipes = {
    "ol-faithful": {},
    "mulch-mallet": {
        "ğŸŸ«": 10000,
        "ğŸŸ§": 333,
        "ğŸŸ¥": 290,
        "ğŸŸª": 250,
        "âš«": 100
    },
    "mud-sickle": {
        "ğŸŸ«": 50000,
        "ğŸŸ¢": 1111,
        "ğŸ”µ": 1000,
        "ğŸŸ¡": 900,
        "ğŸŸ ": 830,
        "ğŸ”´": 700,
        "ğŸŸ£": 625,
        "ğŸŸ¤": 555
    },
    "dirt-ravager": {
        "ğŸŸ«": 100000,
        "ğŸŸ¢": 2222,
        "ğŸ”µ": 2000,
        "ğŸŸ¡": 1820,
        "ğŸŸ ": 1670,
        "ğŸ’š": 1,
        "ğŸ’™": 1
    },
    "void-crusher": {
        "ğŸ“°": 250000,
        "ğŸŸ¢": 5555,
        "ğŸ”µ": 5000,
        "ğŸŸ¡": 4550,
        "ğŸŸ ": 4170,
        "â¤ï¸": 2,
        "ğŸ¤": 1,
        "âš™ï¸": 1
    },
    "geode-staff": {
        "ğŸª¨": 500000,
        "ğŸŸ¢": 11000,
        "ğŸ”µ": 10000,
        "ğŸŸ¡": 9000,
        "ğŸŸ ": 8500,
        "â¤ï¸": 5,
        "ğŸ¤": 3,
        "ğŸ’ ": 1,
        "ğŸ¥": 1
    },
    "earth-soiler": {
        "ğŸŸ«": 650000,
        "ğŸŸ§": 75000,
        "ğŸŸª": 60000,
        "â¤ï¸": 5,
        "ğŸ¤": 3,
        "ğŸ": 1,
        "ğŸ„": 1,
        "ğŸ": 1
    },
    "crypt-smasher": {
        "ğŸŒµ": 500000,
        "ğŸŒŠ": 300000,
        "ğŸŸ¢": 150000,
        "âš«": 75000,
        "ğŸ’›": 7,
        "ğŸ–ï¸": 3,
        "âš±ï¸": 3,
        "ğŸ¤¿": 2,
        "ğŸ«§": 2,
        "ğŸŸ": 2,
        "ğŸ€": 2
    },
    "labrynthian-tide": {
        "ğŸ§±": 5000000,
        "ğŸŒŠ": 5000000,
        "â˜¢ï¸": 5000000,
        "ğŸŸ¢": 500000,
        "ğŸ”±": 2,
        "ğŸ§²": 3,
        "ğŸª¬": 3,
        "ğŸ‘‘": 3,
        "ğŸ‡": 2,
        "ğŸ£": 10,
        "â›µ": 10,
        "ğŸ§©": 7,
        "ğŸ””": 7,
        "ğŸª™": 5,
        "ğŸ—¿": 5
    },
    "77-leaf-destroyer": {
        "ğŸ“°": 15000000,
        "ğŸ§±": 15000000,
        "ğŸ“": 1,
        "ğŸŒŸ": 1,
        "ğŸ”—": 15,
        "ğŸ§¨": 15,
        "ğŸ†": 10,
        "ğŸªš": 50,
        "ğŸªœ": 50,
        "ğŸ²": 50,
        "âœ‚ï¸": 50
    },
    "planet-buster": {
        "ğŸŸ«": 75000000,
        "ğŸ¥—": 2,
        "ğŸŒªï¸": 5,
        "ğŸŒ": 10,
        "ğŸŒ²": 40,
        "ğŸƒ": 45,
        "ğŸ": 50,
        "ğŸ„": 100,
        "ğŸªµ": 100,
        "ğŸŒ»": 100,
        "ğŸ": 100
    },
    "whirlpool-of-fate": {
        "ğŸŒŠ": 200000000,
        "ğŸ’«": 1,
        "ğŸª©": 5,
        "ğŸ‘¿": 10,
        "ğŸŒ€": 10,
        "ğŸ”±": 100,
        "ğŸ‘‘": 100,
        "ğŸŸ": 250,
        "ğŸ«§": 500,
        "ğŸ¤¿": 500,
        "ğŸ£": 500,
        "â›µ": 500
    },
    "wings-of-glory": {
        "ğŸ§±": 150000000,
        "ğŸª¨": 150000000,
        "ğŸŒ«ï¸": 150000000,
        "ğŸŒ‡": 1,
        "ğŸŒˆ": 2,
        "ğŸ‘ï¸": 3,
        "ğŸ’¸": 15,
        "ğŸ§Š": 30,
        "ğŸ¥‰": 30,
        "â„ï¸": 40,
        "ğŸ§µ": 50,
        "ğŸ¤": 750,
        "ğŸ’š": 1500,
        "âš«": 30000000,
        "ğŸŸ¤": 40000000
    }
},
gearRecipes = {
    "ore-tracker": {
        "ğŸª¨": 300000,
        "ğŸŸ§": 25000,
        "ğŸŸ¥": 25000,
        "ğŸŸª": 25000,
        "ğŸ”‹": 1
    },
    "real-candilium": {
        "ğŸŒ«ï¸": 1000000,
        "ğŸ§¡": 10,
        "ğŸ’œ": 5,
        "ğŸ­": 1,
        "ğŸª„": 2,
        "ğŸ•¯ï¸": 1
    },
    "real-vitriol": {
        "ğŸŒµ": 1750000,
        "ğŸ–¤": 1,
        "ğŸ¤": 7,
        "ğŸ–ï¸": 2,
        "âš±ï¸": 2,
        "ğŸ€": 1,
        "â­": 1
    },
    "infinity-collector": {
        "ğŸª¨": 15000000,
        "ğŸ’ ": 25,
        "âšœï¸": 25,
        "ğŸ”‹": 10,
        "ğŸ”®": 7,
        "â˜„ï¸": 5,
        "ğŸ’": 1
    },
    "layer-materializer": {
        "ğŸŸ«": 2500000,
        "ğŸ§±": 2500000,
        "ğŸŒ«ï¸": 2500000,
        "ğŸŒŠ": 2500000,
        "ğŸª¨": 2500000,
        "â˜¢ï¸": 2500000,
        "ğŸŒµ": 2500000,
        "ğŸ“°": 2500000,
        "ğŸ“Ÿ": 15,
        "âŒš": 2,
        "ğŸ”¥": 1
    },
    "fortune-3-book": {
        "ğŸŒ«ï¸": 50000000,
        "ğŸŒŠ": 50000000,
        "ğŸª„": 50,
        "ğŸ¨": 25,
        "ğŸ•‹": 20,
        "ğŸ•¯ï¸": 15,
        "ğŸŒ€": 1,
        "âŒ›": 1,
    },
    "haste-2-beacon": {
        "ğŸŒµ": 75000000,
        "âš±ï¸": 75,
        "ğŸ—¡ï¸": 50,
        "ğŸ€": 20,
        "ğŸ”†": 10,
        "â­": 15,
        "ğŸ’¥": 2,
        "ğŸª": 1
    },
    "energy-siphoner": {
        "ğŸŒ«ï¸": 3000000,
        "ğŸ•‹": 1,
        "ğŸ¨": 2,
        "ğŸ´": 5,
        "ğŸ­": 10
    },
    "sugar-rush": {
        "â˜¢ï¸": 4000000,
        "ğŸ”³": 3,
        "â¹ï¸": 5,
        "âš—ï¸": 15,
        "ğŸ§ª": 20
    },
    "silly-tp": {
        "ğŸ‚": 1,
        "ğŸ”®": 1,
        "ğŸª„": 1
    }
};
const gearList = Object.keys(gearRecipes);

function calcTotalIngredients(ore) {
    let total = 0;
    for (const variant in inventory[ore])
        if (variantNames.indexOf(capitalize(variant)) <= variantNames.indexOf(sellUpToVariant))
            total += inventory[ore][variant];
    return total;
}

let recipeElements = {"pickaxes": {}, "gears": {}};
let currentRecipe = "";
function displayRecipe(item, button) {
    if (button.classList.contains("darkButton")) {
        button.classList.remove("darkButton");
        invisible(document.getElementById("displaySellUpToVariants"));
        if (isVisible(document.getElementById("pickaxeCrafts")))
            invisible(recipeElements["pickaxes"][item]);
        else
            invisible(recipeElements["gears"][item]);
        invisible(document.getElementById("recipeTitle"));
        invisible(document.getElementById("itemDescription"));
        currentRecipe = "";
        return;
    }
    
    visible(document.getElementById("displaySellUpToVariants"));
    visible(document.getElementById("displayRecipe"));
    visible(document.getElementById("recipeTitle"));
    visible(document.getElementById("itemDescription"));
    for (const element of document.querySelectorAll("#pickaxeCrafts > button, #gearCrafts > button"))
        element.classList.remove("darkButton");
    button.classList.add("darkButton");
    
    const allItemNames = {...pickaxeNames, ...gearNamesNormalized};
    currentRecipe = item;
    const type = `${pickOrGear(item)}s`;
    let itemDescription = document.getElementById("itemDescription");
    itemDescription.innerHTML = pickaxeDescriptions[item] ?? gearDescriptions[item];
    let recipes = document.getElementById("displayRecipe");
    recipes.innerHTML = "";
    for (const i in recipeElements[type])
        invisible(recipeElements[type][i]);
    recipes.appendChild(recipeElements[type][item]);
    visible(recipeElements[type][item]);
    let craftButton = document.querySelector(".actualCraftButton");
    if (currentPickaxe === item || currentGears.includes(item))
        craftButton.innerHTML = "Equipped!";
    else if (pickaxes[item] || gears[item])
        craftButton.innerHTML = "Equip!";
    //reimplement hidden recipes and non-ownable gears later
    //actually I can probably add a separate "abilities" thing soon
    let recipeTitle = document.createElement("p");
    recipeTitle.id = "recipeTitle";
    recipeTitle.innerHTML = `${allItemNames[item]}:`;
    if (type === "pickaxes")
        recipeTitle.title = pickaxeSillyDescriptions[item];
    recipes.insertBefore(recipeTitle, recipes.children[0]);
    
    const allRecipes = {...pickaxeRecipes, ...gearRecipes};
    document.querySelector("#displayRecipe > div").removeChild(craftButton);
    for (const ingredient in allRecipes[item]) {
        const totalIngredients = calcTotalIngredients(ingredient);
        let ingredientDisplay = document.createElement("p");
        ingredientDisplay.id = (`ingredientDisplay${ingredient}`);
        ingredientDisplay.classList.add("recipeIngredient");
        ingredientDisplay.innerHTML = `${ingredient} ${totalIngredients.toLocaleString()}/${allRecipes[item][ingredient].toLocaleString()}`;
        if (totalIngredients >= allRecipes[item][ingredient]) {
            ingredientDisplay.classList.add("recipeGreen");
            ingredientDisplay.classList.remove("recipeRed");
        } else {
            ingredientDisplay.classList.add("recipeRed");
            ingredientDisplay.classList.remove("recipeGreen");
        }
        document.querySelector("#displayRecipe > div").appendChild(ingredientDisplay);
    }
    document.querySelector("#displayRecipe > div").appendChild(craftButton);
    
    updateActiveRecipe();
}

//TODO: combine these methods
function createPickaxeRecipes() {
    let pickaxeCrafts = document.getElementById("pickaxeCrafts");
    for (const pick in pickaxeRecipes) {
        let pickaxeDisplay = document.createElement("div");
        pickaxeDisplay.id = `pickaxeRecipe${snakeToCamel(pick, true)}`;
        invisible(pickaxeDisplay);
        pickaxeDisplay.classList.add("craftingAmountsDisplay");
        let button = document.createElement("button");
        button.id = `craftPickaxe${snakeToCamel(pick, true)}`;
        button.classList.add("actualCraftButton");
        button.setAttribute("onclick", `craftPickaxe('${pick}', this)`);
        if (pickaxes[pick])
            button.innerHTML = "Equip!";
        else
            button.innerHTML = "Craft!";
        pickaxeDisplay.appendChild(button);
        recipeElements["pickaxes"][pick] = pickaxeDisplay;
        
        let craftPickaxeButton = document.createElement("button");
        craftPickaxeButton.setAttribute("onclick", `displayRecipe('${pick}', this)`);
        craftPickaxeButton.classList.add("craftPickaxeButton", "craftButton");
        craftPickaxeButton.innerHTML = pickaxeNames[pick];
        pickaxeCrafts.appendChild(craftPickaxeButton);
    }
}

function createGearRecipes() {
    let gearCrafts = document.getElementById("gearCrafts");
    for (const gear in gearRecipes) {
        let gearDisplay = document.createElement("div");
        gearDisplay.id = `gearRecipe${snakeToCamel(gear, true)}`;
        invisible(gearDisplay);
        gearDisplay.classList.add("craftingAmountsDisplay");
        let button = document.createElement("button");
        button.id = `craftGear${snakeToCamel(gear, true)}`;
        button.classList.add("actualCraftButton");
        button.setAttribute("onclick", `craftGear('${gear}', this)`);
        if (gears[gear]) {
            if (gear !== "silly-tp") {
                if (currentGears.includes(gear))
                    button.innerHTML = "Equipped!";
                else
                    button.innerHTML = "Equip!";
            } else button.innerHTML = "Teleport!";
        } else button.innerHTML = "Craft!";
        gearDisplay.appendChild(button);
        recipeElements["gears"][gear] = gearDisplay;
        
        let craftGearButton = document.createElement("button");
        //TODO: make a better unlock system
        if (!gears["silly-tp"] && calcTotalIngredients("ğŸ‚") === 0 && gear === "silly-tp")
            invisible(craftGearButton);
        craftGearButton.setAttribute("onclick", `displayRecipe('${gear}', this)`);
        craftGearButton.classList.add("craftGearButton", "craftButton");
        craftGearButton.innerHTML = gearNamesNormalized[gear];
        gearCrafts.appendChild(craftGearButton);
    }
}

function updateActiveRecipe(ore) {
    const allRecipes = {...pickaxeRecipes, ...gearRecipes};
    let ingredientDisplay = document.getElementById(`ingredientDisplay${ore}`);
    if (ingredientDisplay === null) {
        for (const ingredient in allRecipes[currentRecipe]) {
            const totalOres = calcTotalIngredients(ingredient);
            const row = document.getElementById(`ingredientDisplay${ingredient}`);
            row.innerHTML = `${ingredient} ${totalOres.toLocaleString()}/${allRecipes[currentRecipe][ingredient].toLocaleString()}`;
            if (totalOres >= allRecipes[currentRecipe][ingredient]) {
                row.classList.add("recipeGreen");
                row.classList.remove("recipeRed");
            } else {
                row.classList.add("recipeRed");
                row.classList.remove("recipeGreen");
            }
        }
    } else {
        const totalOres = calcTotalIngredients(ore);
        ingredientDisplay.innerHTML = `${ore} ${totalOres.toLocaleString()}/${allRecipes[currentRecipe][ore].toLocaleString()}`;
        if (totalOres >= allRecipes[currentRecipe][ore]) {
            ingredientDisplay.classList.add("recipeGreen");
            ingredientDisplay.classList.remove("recipeRed");
        } else {
            ingredientDisplay.classList.add("recipeRed");
            ingredientDisplay.classList.remove("recipeGreen");
        }
    }
}

function craftPickaxe(pick) {
    canCraft = true;
    if (!pickaxes[pick]) {
        for (const ingredient in pickaxeRecipes[pick]) {
            if (calcTotalIngredients(ingredient) < pickaxeRecipes[pick][ingredient]) {
                canCraft = false;
                break;
            }
        }
        if (canCraft) {
            pickaxes[pick] = true;
            currentPickaxe = pick;
            for (const ingredient in pickaxeRecipes[pick]) {
                let remainder = pickaxeRecipes[gear][ingredient];
                for (const v of variantNames) {
                    const variant = v.toLowerCase();
                    if (inventory[ingredient][variant] < remainder) {
                        remainder -= inventory[ingredient][variant];
                        inventory[ingredient][variant] = 0;
                    } else {
                        inventory[ingredient][variant] -= remainder;
                        break;
                    }
                }
                updateInventory(ingredient);
            }
            let pickaxeDisplay = document.getElementById(`pickaxeRecipe${snakeToCamel(pick, true)}`);
            pickaxeDisplay.lastElementChild.innerHTML = "Equipped!";
            updateActiveRecipe();
            createIndex();
            currentPickaxe = pick;
        }
    } else {
        let pickaxeDisplay = document.getElementById(`pickaxeRecipe${snakeToCamel(pick, true)}`);
        pickaxeDisplay.lastElementChild.innerHTML = "Equipped!";
        currentPickaxe = pick;
    }
}
function craftGear(gear, button) {
    canCraft = true;
    let gearDisplay = document.getElementById(`gearRecipe${snakeToCamel(gear, true)}`);
    button = button || gearDisplay.lastElementChild.innerHTML;
    if (!gears[gear]) {
        for (const ingredient in gearRecipes[gear]) {
            if (calcTotalIngredients(ingredient) < gearRecipes[gear][ingredient]) {
                canCraft = false;
                break;
            }
        }
        if (canCraft) {
            gears[gear] = true;
            currentGears.push(gear);
            for (const ingredient in gearRecipes[gear]) {
                let remainder = gearRecipes[gear][ingredient];
                for (const v of variantNames) {
                    const variant = v.toLowerCase();
                    if (inventory[ingredient][variant] < remainder) {
                        remainder -= inventory[ingredient][variant];
                        inventory[ingredient][variant] = 0;
                    } else {
                        inventory[ingredient][variant] -= remainder;
                        break;
                    }
                }
                updateInventory(ingredient);
            }
            button.innerHTML = gear !== "silly-tp" ? "Equipped!" : "Teleport!";
            updateActiveRecipe();
            createIndex();
        } else button.innerHTML = "Craft!";
    } else if (!currentGears.includes(gear)) {
        button.innerHTML = gear !== "silly-tp" ? "Equipped!" : "Teleport!";
        currentGears.push(gear);
    } else {
        button.innerHTML = gear !== "silly-tp" ? "Equip!" : "Teleport!";
        currentGears.splice(currentGears.indexOf(gear), 1);
    }
    if (gear === "silly-tp" && gears["silly-tp"]) gearAbilitySillyTp();
}

//gotta combine these at some point
function showPickaxes() {
    if (document.getElementById("showPickaxes").classList.contains("darkButton")) {
        document.getElementById("showPickaxes").classList.remove("darkButton");
        invisible(document.getElementById("pickaxeCrafts"));
        invisible(document.getElementById("displayRecipe"));
        invisible(document.getElementById("recipeTitle"));
        invisible(document.getElementById("itemDescription"));
        invisible(document.getElementById("displaySellUpToVariants"));
    } else {
        visible(document.getElementById("pickaxeCrafts"));
        document.getElementById("showPickaxes").classList.add("darkButton");
        invisible(document.getElementById("gearCrafts"));
        document.getElementById("showGears").classList.remove("darkButton");
    }
}
function showGears() {
    if (document.getElementById("showGears").classList.contains("darkButton")) {
        document.getElementById("showGears").classList.remove("darkButton");
        invisible(document.getElementById("gearCrafts"));
        invisible(document.getElementById("displayRecipe"));
        invisible(document.getElementById("recipeTitle"));
        invisible(document.getElementById("itemDescription"));
        invisible(document.getElementById("displaySellUpToVariants"));
    } else {
        invisible(document.getElementById("pickaxeCrafts"));
        document.getElementById("showPickaxes").classList.remove("darkButton");
        visible(document.getElementById("gearCrafts"));
        document.getElementById("showGears").classList.add("darkButton");
    }
}
